# Prompt 16: Final Integration & Testing

## Phase: 5 (Polish)
## Parallel Group: E
## Dependencies: All previous prompts

---

## Objective

Final integration testing, bug fixes, and demo preparation.

## Integration Checklist

### Smart Contracts ↔ Frontend

- [ ] OrderEscrow: createOrder, confirmDelivery, disputeOrder
- [ ] ReviewRegistry: submitReview, getProductRating
- [ ] TipJar: tip, withdrawTips
- [ ] GiftShop: sendGift, getGifts

### Subgraph ↔ Frontend

- [ ] Orders query working
- [ ] Reviews query working
- [ ] Tips/Gifts query working
- [ ] Real-time updates via polling/subscription

### Database ↔ Frontend

- [ ] Sellers CRUD
- [ ] Products CRUD
- [ ] Streams CRUD
- [ ] Orders metadata
- [ ] Reviews content
- [ ] Chat messages
- [ ] Watch sessions

### Streaming ↔ Frontend

- [ ] Create stream (Mux)
- [ ] Get stream key
- [ ] Playback working
- [ ] Webhooks updating status
- [ ] Recording available

## End-to-End Test Flows

### Flow 1: Seller Onboarding
```
1. Connect WEPIN wallet
2. Register as seller
3. Upload product
4. Create stream
5. Go live (with OBS)
6. Verify stream visible to viewers
```

### Flow 2: Buyer Purchase
```
1. Connect WEPIN wallet
2. Browse live streams
3. Join stream
4. Click product
5. Complete purchase (VERY payment)
6. Verify order in escrow
7. Confirm delivery
8. Submit review
9. Verify review on-chain
```

### Flow 3: Tips & Gifts
```
1. Join live stream
2. Send gift
3. Verify animation
4. Verify streamer received
5. Send tip with message
6. Verify in chat
```

### Flow 4: Watch-to-Earn
```
1. Join stream (KYC verified)
2. Watch for 5 minutes
3. Verify reward toast
4. Complete attention check
5. Watch for 30 minutes total
6. Verify milestone reward
7. Check daily earnings
```

## Bug Fixes Checklist

Common issues to check:

- [ ] Wallet connection edge cases
- [ ] Transaction error handling
- [ ] Loading states everywhere
- [ ] Mobile responsive layouts
- [ ] Korean text display
- [ ] VERY amount formatting
- [ ] Stream reconnection
- [ ] Chat scroll behavior

## Performance Checks

- [ ] Page load times < 3s
- [ ] Stream latency acceptable
- [ ] No memory leaks in chat
- [ ] Subgraph query performance

## Demo Script Implementation

### Scene 1: The Problem (20 sec)
```tsx
// Landing page with problem stats
// "Traditional live commerce: 20% fees"
// "Fake reviews everywhere"
```

### Scene 2: Seller Goes Live (40 sec)
```tsx
// Pre-recorded OBS stream
// Show dashboard stats updating
// Viewers joining
// Chat active
```

### Scene 3: One-Tap Purchase (40 sec)
```tsx
// Viewer clicks product
// WEPIN confirmation
// Payment instant
// Seller notification
```

### Scene 4: Verified Review (30 sec)
```tsx
// Order confirmed
// Review submission
// Badges displayed
// VERY reward
```

### Scene 5: Earnings (20 sec)
```tsx
// Show viewer rewards
// Show seller earnings (low fees)
// "Everyone wins"
```

## Environment Configuration

### Production Checklist

```env
# Required for production
NEXT_PUBLIC_WEPIN_APP_ID=
NEXT_PUBLIC_WEPIN_APP_KEY=
NEXT_PUBLIC_VERYCHAT_PROJECT_ID=
NEXT_PUBLIC_VERYCHAIN_RPC_URL=

# Mux
MUX_TOKEN_ID=
MUX_TOKEN_SECRET=
MUX_WEBHOOK_SECRET=

# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Contract addresses (update after deployment)
NEXT_PUBLIC_ORDER_ESCROW_ADDRESS=
NEXT_PUBLIC_REVIEW_REGISTRY_ADDRESS=
NEXT_PUBLIC_TIP_JAR_ADDRESS=
NEXT_PUBLIC_GIFT_SHOP_ADDRESS=

# Subgraph
NEXT_PUBLIC_SUBGRAPH_URL=http://localhost:8000/subgraphs/name/labang
```

### Contract Deployment to VeryChain

```bash
cd contracts

# Deploy to Polygon Amoy first (testnet)
forge script script/Deploy.s.sol --rpc-url $AMOY_RPC --broadcast --verify

# After testing, deploy to VeryChain
forge script script/Deploy.s.sol --rpc-url $VERYCHAIN_RPC --broadcast
```

### Subgraph Deployment

```bash
cd subgraph

# Update addresses in config/verychain.json
npm run prepare:verychain
npm run build

# Deploy to local graph-node
graph deploy --node http://localhost:8020/ --ipfs http://localhost:5001 labang
```

## Final Deliverables

1. **Working Demo**
   - All flows functional
   - Test accounts with VERY balance
   - Sample products and streams

2. **Documentation**
   - README with setup instructions
   - API documentation
   - Contract addresses

3. **Demo Video**
   - 2-3 minute walkthrough
   - Following demo script from PRD

## DO NOT

- Leave console.log statements
- Skip error handling
- Leave TODO comments unresolved
- Deploy with test credentials
